{% extends "ReqAppt/apt_base.html" %}
{% block content %}


<div>
    <form action="{% url 'create_Appointment' %}" method="post">
        {% csrf_token %}
        <!-- {{ form.as_p }} -->
        <!-- Provider Type -->
        <div class="row">
            <div class="col">
                <div style="display:inline-block; text-align:right; padding-right:64px; padding-bottom:15px;">
                    <b> {{form.providerType.label_tag}} </b>
                    {{form.providerType}}
                </div>
            </div>
        </div>

        <!-- Provider -->
        <div class="row">
            <div class="col">
                <div style="display:inline-block; text-align:right; padding-right:27px; padding-bottom:15px;">
                    <b> {{form.provider.label_tag}} </b>
                    {{form.provider}}
                </div>
            </div>
        </div>

        <!-- Patient First Name -->
        <div class="row">
            <div class="col">
                <div style="display:inline-block; text-align:right; padding-right:64px; padding-bottom:15px;">
                    <b> {{form.patientFname.label_tag}} </b>
                    {{form.patientFname}}
                </div>
            </div>
        </div>

        <!-- Patient Last Name -->
        <div class="row">
            <div class="col">
                <div style="display:inline-block; text-align:right; padding-right:64px; padding-bottom:15px;">
                    <b> {{form.patientLname.label_tag}} </b>
                    {{form.patientLname}}
                </div>
            </div>
        </div>
        <!-- {{ form.as_p }} -->
        <p>Date: <input name="apptDate" type="text" id="datepicker" required></p>
        <p id='hour' style='display: inline'> Hour: <select name="apptHour" id="timeslots" required></p>

        <br>
        <div class="row">
            <div class="col">
                <div style="display:inline-block; text-align:right; margin-left:50px; padding-bottom:15px;">
                    <button type="submit" class="btn btn-primary btn-large btn-block">OK</button>
                </div>
            </div>
    </form>
</div>
<!-- <table class="table table" id="-table">



    </table> -->

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<script>


      $( function() {
        $("#datepicker").datepicker();
      } );


      const loadTimeSlots = (data) => {
          const timeslots = $("#timeslots");
          timeslots.empty();
          data.forEach( d => {
              timeslots.append(`<option value="${d}">${d}</option>`)
          });
      }

      const changeHandler = () => {
          const provider_id = $('#id_provider').val();
          const date = $('#datepicker').val();
          if(!!provider_id && !!date){
              $.get(`availability/provider/${provider_id}/date/${date.replaceAll('/', '-')}`, loadTimeSlots)
          }else{
              //Clear out dropdown if either provider or date is null
              const timeslots = $("#timeslots");
              timeslots.empty();
          }
      };


      $(() => $("#id_provider, #datepicker").on('change', changeHandler));

  </script>

{% endblock content %}